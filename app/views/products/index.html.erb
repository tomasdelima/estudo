<%= flash[:buy] %>
<%= flash[:notice] %><br>
<%= flash[:logout] %>
<% if session[:user_id] %>
  You are logged in as <%= User.find(session[:user_id]).name %> <br>
<% end %>

<% @s=0 ; CartsProduct.where(cart_id: session[:cart_id]).each {|a| @s += a.quantity} %>
Your cart has <b id="sum"> <%= @s %> </b> products <br>

<h1>Listing all products</h1>

<table>
  <tr>
    <td><strong>Name:</strong></td>
    <td><strong>Price:</strong></td>
  </tr>
  <% @products.each do |product| %>
    <% s = 0 %>
    <tr>
      <% carts_product = CartsProduct.find_by(cart_id: session[:cart_id], product_id: product.id) %>
      <td> <%= product.name %></td>
      <td align=right> <%= number_to_currency product.price, unit: '' %></td>
      <td> <%= button_to 'View product details', product_path(product.id), method: :get %></td>
      <td> <button class='mp' data-operation='minus' data-id='<%= product.id %>'> - </button></td>
      <td> <div id="div<%= product.id %>"> <%= carts_product.quantity if carts_product %></div></td>
      <td> <button class='mp' data-operation='plus'  data-id='<%= product.id %>'> + </button></td>
    </tr>
  <% end %>
</table>
<br>

<% link_to 'Add products to Cart', products_path %>
<%= button_to 'View the Cart', cart_path(session[:cart_id]), method: :get %>
<%= button_to 'Buy this Cart', buy_cart_path(session[:cart_id]), data:{ :confirm => "Confirm?" } %>
<% if current_user and current_user.admin %>
  <%= button_to 'New product', new_product_path, method: :get %>
<% end %>
<% @user = User.new %>











